<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="A comprehensive guide to essential computational tools for graduate students in bioengineering and life sciences, covering Unix/Linux, R programming, version control with Git/GitHub, and high-performance computing.">
<title>12&nbsp; Working with Databases – Foundational Computational Tools for Bioengineers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/12-quarto-documents.html" rel="next">
<link href="../chapters/14-parallel-computing.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d447b626f1df67f6a2368ec23f4c5255.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-c7529a8313f81663d953c47b1ab362ff.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d447b626f1df67f6a2368ec23f4c5255.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0dd4bede59fce912683c1f38b3836bca.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-eb3cfb2dc3b1d18999aa5075de07535d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-0dd4bede59fce912683c1f38b3836bca.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/15-databases.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Working with Databases</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/uo_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Foundational Computational Tools for Bioengineers</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/wcresko/BioE_Comp_Tools_Book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Computational Tools</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-computer-systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Computer Systems Architecture</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-unix-fundamentals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Unix Fundamentals</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-files-pipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Files, Pipes, and Redirection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-grep-regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">GREP and Regular Expressions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-shell-scripting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Shell Scripting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-r-programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">R Programming Fundamentals</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-tidy-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Tidy Data Principles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-data-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13-writing-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Writing Functions in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14-parallel-computing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Parallel Computing in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/15-databases.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Working with Databases</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-quarto-documents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Reproducible Documents with Quarto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-git-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Version Control with Git and GitHub</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-hpc-talapas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">High-Performance Computing with Talapas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/appendix-unix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Unix Command Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/appendix-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Git Command Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/appendix-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">R Command Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/appendix-slurm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">SLURM Command Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/appendix-regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Regular Expression Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/appendix-shortcuts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Keyboard Shortcuts Reference</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#sec-why-databases" id="toc-sec-why-databases" class="nav-link active" data-scroll-target="#sec-why-databases"><span class="header-section-number">12.1</span> Why Databases?</a></li>
  <li>
<a href="#sec-db-basics" id="toc-sec-db-basics" class="nav-link" data-scroll-target="#sec-db-basics"><span class="header-section-number">12.2</span> Database Basics</a>
  <ul class="collapse">
<li><a href="#types-of-database-systems" id="toc-types-of-database-systems" class="nav-link" data-scroll-target="#types-of-database-systems">Types of Database Systems</a></li>
  </ul>
</li>
  <li>
<a href="#sec-db-connecting" id="toc-sec-db-connecting" class="nav-link" data-scroll-target="#sec-db-connecting"><span class="header-section-number">12.3</span> Connecting to Databases</a>
  <ul class="collapse">
<li><a href="#using-duckdb-for-learning" id="toc-using-duckdb-for-learning" class="nav-link" data-scroll-target="#using-duckdb-for-learning">Using duckdb for Learning</a></li>
  <li><a href="#connecting-to-other-databases" id="toc-connecting-to-other-databases" class="nav-link" data-scroll-target="#connecting-to-other-databases">Connecting to Other Databases</a></li>
  </ul>
</li>
  <li>
<a href="#sec-db-loading" id="toc-sec-db-loading" class="nav-link" data-scroll-target="#sec-db-loading"><span class="header-section-number">12.4</span> Loading Data into a Database</a>
  <ul class="collapse">
<li><a href="#reading-tables" id="toc-reading-tables" class="nav-link" data-scroll-target="#reading-tables">Reading Tables</a></li>
  </ul>
</li>
  <li>
<a href="#sec-sql" id="toc-sec-sql" class="nav-link" data-scroll-target="#sec-sql"><span class="header-section-number">12.5</span> SQL: The Language of Databases</a>
  <ul class="collapse">
<li><a href="#basic-sql-queries" id="toc-basic-sql-queries" class="nav-link" data-scroll-target="#basic-sql-queries">Basic SQL Queries</a></li>
  <li><a href="#sql-query-structure" id="toc-sql-query-structure" class="nav-link" data-scroll-target="#sql-query-structure">SQL Query Structure</a></li>
  </ul>
</li>
  <li>
<a href="#sec-dbplyr" id="toc-sec-dbplyr" class="nav-link" data-scroll-target="#sec-dbplyr"><span class="header-section-number">12.6</span> Using dbplyr: dplyr for Databases</a>
  <ul class="collapse">
<li><a href="#creating-a-database-reference" id="toc-creating-a-database-reference" class="nav-link" data-scroll-target="#creating-a-database-reference">Creating a Database Reference</a></li>
  <li><a href="#lazy-evaluation" id="toc-lazy-evaluation" class="nav-link" data-scroll-target="#lazy-evaluation">Lazy Evaluation</a></li>
  <li><a href="#collecting-results" id="toc-collecting-results" class="nav-link" data-scroll-target="#collecting-results">Collecting Results</a></li>
  </ul>
</li>
  <li>
<a href="#sec-dplyr-sql" id="toc-sec-dplyr-sql" class="nav-link" data-scroll-target="#sec-dplyr-sql"><span class="header-section-number">12.7</span> Translating dplyr to SQL</a>
  <ul class="collapse">
<li><a href="#filtering-and-selecting" id="toc-filtering-and-selecting" class="nav-link" data-scroll-target="#filtering-and-selecting">Filtering and Selecting</a></li>
  <li><a href="#mutating-creating-new-columns" id="toc-mutating-creating-new-columns" class="nav-link" data-scroll-target="#mutating-creating-new-columns">Mutating (Creating New Columns)</a></li>
  <li><a href="#grouping-and-summarizing" id="toc-grouping-and-summarizing" class="nav-link" data-scroll-target="#grouping-and-summarizing">Grouping and Summarizing</a></li>
  <li><a href="#arranging-sorting" id="toc-arranging-sorting" class="nav-link" data-scroll-target="#arranging-sorting">Arranging (Sorting)</a></li>
  </ul>
</li>
  <li>
<a href="#sec-sql-syntax" id="toc-sec-sql-syntax" class="nav-link" data-scroll-target="#sec-sql-syntax"><span class="header-section-number">12.8</span> SQL Syntax Details</a>
  <ul class="collapse">
<li><a href="#key-differences-from-r" id="toc-key-differences-from-r" class="nav-link" data-scroll-target="#key-differences-from-r">Key Differences from R</a></li>
  <li><a href="#null-handling" id="toc-null-handling" class="nav-link" data-scroll-target="#null-handling">NULL Handling</a></li>
  <li><a href="#subqueries" id="toc-subqueries" class="nav-link" data-scroll-target="#subqueries">Subqueries</a></li>
  </ul>
</li>
  <li><a href="#sec-db-multiple-tables" id="toc-sec-db-multiple-tables" class="nav-link" data-scroll-target="#sec-db-multiple-tables"><span class="header-section-number">12.9</span> Working with Multiple Tables</a></li>
  <li><a href="#sec-window-functions" id="toc-sec-window-functions" class="nav-link" data-scroll-target="#sec-window-functions"><span class="header-section-number">12.10</span> Window Functions</a></li>
  <li>
<a href="#sec-db-best-practices" id="toc-sec-db-best-practices" class="nav-link" data-scroll-target="#sec-db-best-practices"><span class="header-section-number">12.11</span> Best Practices</a>
  <ul class="collapse">
<li><a href="#filter-early" id="toc-filter-early" class="nav-link" data-scroll-target="#filter-early">1. Filter Early</a></li>
  <li><a href="#select-only-needed-columns" id="toc-select-only-needed-columns" class="nav-link" data-scroll-target="#select-only-needed-columns">2. Select Only Needed Columns</a></li>
  <li><a href="#aggregate-in-the-database" id="toc-aggregate-in-the-database" class="nav-link" data-scroll-target="#aggregate-in-the-database">3. Aggregate in the Database</a></li>
  <li><a href="#close-connections" id="toc-close-connections" class="nav-link" data-scroll-target="#close-connections">4. Close Connections</a></li>
  </ul>
</li>
  <li><a href="#sec-when-databases" id="toc-sec-when-databases" class="nav-link" data-scroll-target="#sec-when-databases"><span class="header-section-number">12.12</span> When to Use Databases</a></li>
  <li><a href="#sec-db-summary" id="toc-sec-db-summary" class="nav-link" data-scroll-target="#sec-db-summary"><span class="header-section-number">12.13</span> Summary</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/wcresko/BioE_Comp_Tools_Book/edit/main/chapters/15-databases.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/wcresko/BioE_Comp_Tools_Book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-databases" class="quarto-section-identifier"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Working with Databases</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><div class="callout callout-style-default callout-note callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>After completing this chapter, you will be able to:</p>
<ul>
<li>Understand database fundamentals and when to use them</li>
<li>Connect to databases from R using DBI</li>
<li>Write basic SQL queries</li>
<li>Use dbplyr to work with databases using familiar dplyr syntax</li>
<li>Translate between dplyr operations and SQL</li>
<li>Work with in-process databases like duckdb for large datasets</li>
</ul>
</div>
</div>
<section id="sec-why-databases" class="level2" data-number="12.1"><h2 data-number="12.1" class="anchored" data-anchor-id="sec-why-databases">
<span class="header-section-number">12.1</span> Why Databases?</h2>
<p>A huge amount of scientific data lives in databases. While you can sometimes ask a collaborator to export a snapshot to a CSV file, this approach becomes painful quickly: every time you need updated data or a different subset, you must coordinate with another person. Being able to access databases directly gives you the data you need, when you need it.</p>
<p>Databases offer several advantages over flat files:</p>
<ul>
<li>
<strong>Scale</strong>: Databases can handle datasets too large to fit in memory</li>
<li>
<strong>Speed</strong>: Indexes enable fast queries on specific subsets</li>
<li>
<strong>Concurrent access</strong>: Multiple users can safely read and write simultaneously</li>
<li>
<strong>Data integrity</strong>: Constraints prevent invalid data from being entered</li>
<li>
<strong>Security</strong>: Fine-grained access controls protect sensitive information</li>
</ul>
<p>In biosciences, you’ll encounter databases for:</p>
<ul>
<li>Genomic sequence repositories</li>
<li>Clinical trial data</li>
<li>Laboratory information management systems (LIMS)</li>
<li>Institutional data warehouses</li>
<li>Public resources like NCBI, Ensembl, and UniProt</li>
</ul></section><section id="sec-db-basics" class="level2" data-number="12.2"><h2 data-number="12.2" class="anchored" data-anchor-id="sec-db-basics">
<span class="header-section-number">12.2</span> Database Basics</h2>
<p>At the simplest level, you can think of a database as a collection of data frames, called <strong>tables</strong> in database terminology. Like a data frame, a database table is a collection of named columns where every value in a column is the same type.</p>
<p>There are three key differences between data frames and database tables:</p>
<ol type="1">
<li><p><strong>Storage</strong>: Database tables are stored on disk and can be arbitrarily large. Data frames are stored in memory and limited by available RAM.</p></li>
<li><p><strong>Indexes</strong>: Database tables almost always have indexes that enable fast lookups without scanning every row—like the index of a book.</p></li>
<li><p><strong>Orientation</strong>: Traditional databases are <strong>row-oriented</strong> (optimized for adding records), while analytical databases are increasingly <strong>column-oriented</strong> (optimized for computing statistics).</p></li>
</ol>
<section id="types-of-database-systems" class="level3"><h3 class="anchored" data-anchor-id="types-of-database-systems">Types of Database Systems</h3>
<p>Database management systems (DBMS) come in three main forms:</p>
<div id="tbl-dbms-types" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-dbms-types-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.1: Types of database management systems
</figcaption><div aria-describedby="tbl-dbms-types-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 44%">
<col style="width: 34%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Examples</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Client-server</strong></td>
<td style="text-align: left;">Central server, multiple client connections</td>
<td style="text-align: left;">PostgreSQL, MySQL, SQL Server</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Cloud</strong></td>
<td style="text-align: left;">Managed cloud services, auto-scaling</td>
<td style="text-align: left;">Amazon Redshift, Google BigQuery, Snowflake</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>In-process</strong></td>
<td style="text-align: left;">Runs entirely within your application</td>
<td style="text-align: left;">SQLite, DuckDB</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>For learning and local analysis, in-process databases like <strong>duckdb</strong> are ideal—no server setup required, and they’re designed for analytical workloads.</p>
</section></section><section id="sec-db-connecting" class="level2" data-number="12.3"><h2 data-number="12.3" class="anchored" data-anchor-id="sec-db-connecting">
<span class="header-section-number">12.3</span> Connecting to Databases</h2>
<p>To connect to a database from R, you need two packages:</p>
<ul>
<li>
<strong>DBI</strong> (DataBase Interface): Provides generic functions for connecting, querying, and managing databases</li>
<li>
<strong>A database driver</strong>: A package specific to your DBMS (e.g., RPostgres, RMariaDB, duckdb)</li>
</ul>
<section id="using-duckdb-for-learning" class="level3"><h3 class="anchored" data-anchor-id="using-duckdb-for-learning">Using duckdb for Learning</h3>
<p>duckdb is a high-performance analytical database that’s perfect for learning. It runs entirely within R and requires no external setup:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Create an in-memory database (temporary, deleted when R closes)</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For persistent storage in a real project, specify a file path:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Persistent database stored in a file</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> <span class="st">"my_database.duckdb"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="connecting-to-other-databases" class="level3"><h3 class="anchored" data-anchor-id="connecting-to-other-databases">Connecting to Other Databases</h3>
<p>Different databases require different connection parameters:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># PostgreSQL</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(</span>
<span id="cb3-3"><a href="#cb3-3"></a>  RPostgres<span class="sc">::</span><span class="fu">Postgres</span>(),</span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="at">host =</span> <span class="st">"database.example.com"</span>,</span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="at">port =</span> <span class="dv">5432</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="at">dbname =</span> <span class="st">"mydb"</span>,</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="at">user =</span> <span class="st">"username"</span>,</span>
<span id="cb3-8"><a href="#cb3-8"></a>  <span class="at">password =</span> <span class="st">"password"</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>)</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co"># MySQL/MariaDB</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(</span>
<span id="cb3-13"><a href="#cb3-13"></a>  RMariaDB<span class="sc">::</span><span class="fu">MariaDB</span>(),</span>
<span id="cb3-14"><a href="#cb3-14"></a>  <span class="at">host =</span> <span class="st">"localhost"</span>,</span>
<span id="cb3-15"><a href="#cb3-15"></a>  <span class="at">dbname =</span> <span class="st">"mydb"</span>,</span>
<span id="cb3-16"><a href="#cb3-16"></a>  <span class="at">username =</span> <span class="st">"user"</span></span>
<span id="cb3-17"><a href="#cb3-17"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Never put passwords directly in your code! Use environment variables, the keyring package, or configuration files that aren’t committed to version control.</p>
</div>
</div>
</section></section><section id="sec-db-loading" class="level2" data-number="12.4"><h2 data-number="12.4" class="anchored" data-anchor-id="sec-db-loading">
<span class="header-section-number">12.4</span> Loading Data into a Database</h2>
<p>Let’s create some example tables to work with. We’ll use familiar datasets:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Write data frames to database tables</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">dbWriteTable</span>(con, <span class="st">"mtcars"</span>, mtcars)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">dbWriteTable</span>(con, <span class="st">"iris"</span>, iris)</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># Verify the tables exist</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="fu">dbListTables</span>(con)</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; [1] "iris"   "mtcars"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="reading-tables" class="level3"><h3 class="anchored" data-anchor-id="reading-tables">Reading Tables</h3>
<p>You can read an entire table into R:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Read a table into R as a data frame</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>con <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">dbReadTable</span>(<span class="st">"mtcars"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">mpg</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">disp</th>
<th style="text-align: right;">hp</th>
<th style="text-align: right;">drat</th>
<th style="text-align: right;">wt</th>
<th style="text-align: right;">qsec</th>
<th style="text-align: right;">vs</th>
<th style="text-align: right;">am</th>
<th style="text-align: right;">gear</th>
<th style="text-align: right;">carb</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.620</td>
<td style="text-align: right;">16.46</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.875</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">108.0</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">3.85</td>
<td style="text-align: right;">2.320</td>
<td style="text-align: right;">18.61</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">258.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.215</td>
<td style="text-align: right;">19.44</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">360.0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">18.1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">225.0</td>
<td style="text-align: right;">105</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">3.460</td>
<td style="text-align: right;">20.22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">14.3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">360.0</td>
<td style="text-align: right;">245</td>
<td style="text-align: right;">3.21</td>
<td style="text-align: right;">3.570</td>
<td style="text-align: right;">15.84</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">24.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">146.7</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">3.69</td>
<td style="text-align: right;">3.190</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">140.8</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">3.92</td>
<td style="text-align: right;">3.150</td>
<td style="text-align: right;">22.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">19.2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">167.6</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">3.92</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">18.30</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">167.6</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">3.92</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">18.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">16.4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">275.8</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">4.070</td>
<td style="text-align: right;">17.40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17.3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">275.8</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">3.730</td>
<td style="text-align: right;">17.60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">15.2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">275.8</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">3.780</td>
<td style="text-align: right;">18.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">472.0</td>
<td style="text-align: right;">205</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">5.250</td>
<td style="text-align: right;">17.98</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">460.0</td>
<td style="text-align: right;">215</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">5.424</td>
<td style="text-align: right;">17.82</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">14.7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">440.0</td>
<td style="text-align: right;">230</td>
<td style="text-align: right;">3.23</td>
<td style="text-align: right;">5.345</td>
<td style="text-align: right;">17.42</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">32.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">78.7</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">4.08</td>
<td style="text-align: right;">2.200</td>
<td style="text-align: right;">19.47</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">75.7</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">4.93</td>
<td style="text-align: right;">1.615</td>
<td style="text-align: right;">18.52</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">33.9</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">71.1</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">4.22</td>
<td style="text-align: right;">1.835</td>
<td style="text-align: right;">19.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21.5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">120.1</td>
<td style="text-align: right;">97</td>
<td style="text-align: right;">3.70</td>
<td style="text-align: right;">2.465</td>
<td style="text-align: right;">20.01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">318.0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">3.520</td>
<td style="text-align: right;">16.87</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15.2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">304.0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">3.435</td>
<td style="text-align: right;">17.30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">13.3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">350.0</td>
<td style="text-align: right;">245</td>
<td style="text-align: right;">3.73</td>
<td style="text-align: right;">3.840</td>
<td style="text-align: right;">15.41</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19.2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">400.0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.845</td>
<td style="text-align: right;">17.05</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">79.0</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">4.08</td>
<td style="text-align: right;">1.935</td>
<td style="text-align: right;">18.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">26.0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">120.3</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">4.43</td>
<td style="text-align: right;">2.140</td>
<td style="text-align: right;">16.70</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">95.1</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">3.77</td>
<td style="text-align: right;">1.513</td>
<td style="text-align: right;">16.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15.8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">351.0</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">4.22</td>
<td style="text-align: right;">3.170</td>
<td style="text-align: right;">14.50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">19.7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">145.0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.62</td>
<td style="text-align: right;">2.770</td>
<td style="text-align: right;">15.50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15.0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">301.0</td>
<td style="text-align: right;">335</td>
<td style="text-align: right;">3.54</td>
<td style="text-align: right;">3.570</td>
<td style="text-align: right;">14.60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">121.0</td>
<td style="text-align: right;">109</td>
<td style="text-align: right;">4.11</td>
<td style="text-align: right;">2.780</td>
<td style="text-align: right;">18.60</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>However, for large tables this defeats the purpose of using a database. Instead, you’ll want to query just the data you need.</p>
</section></section><section id="sec-sql" class="level2" data-number="12.5"><h2 data-number="12.5" class="anchored" data-anchor-id="sec-sql">
<span class="header-section-number">12.5</span> SQL: The Language of Databases</h2>
<p><strong>SQL</strong> (Structured Query Language) is the standard language for working with databases. While we’ll primarily use dbplyr to write dplyr code that gets translated to SQL, understanding SQL basics is valuable.</p>
<section id="basic-sql-queries" class="level3"><h3 class="anchored" data-anchor-id="basic-sql-queries">Basic SQL Queries</h3>
<p>The most common SQL operation is <code>SELECT</code>, which retrieves data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Run a SQL query directly</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>sql <span class="ot">&lt;-</span> <span class="st">"SELECT mpg, cyl, hp FROM mtcars WHERE mpg &gt; 25"</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>result <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, sql)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="fu">as_tibble</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">mpg</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">hp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">32.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">66</td>
</tr>
<tr class="even">
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">52</td>
</tr>
<tr class="odd">
<td style="text-align: right;">33.9</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">65</td>
</tr>
<tr class="even">
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">66</td>
</tr>
<tr class="odd">
<td style="text-align: right;">26.0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">91</td>
</tr>
<tr class="even">
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">113</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="sql-query-structure" class="level3"><h3 class="anchored" data-anchor-id="sql-query-structure">SQL Query Structure</h3>
<p>A SQL query follows this general pattern:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">SELECT</span> <span class="kw">columns</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">FROM</span> <span class="kw">table</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">WHERE</span> conditions</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">columns</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="kw">columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The clauses must appear in this order, though not all are required.</p>
<div id="tbl-sql-clauses" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sql-clauses-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.2: SQL clauses and their dplyr equivalents
</figcaption><div aria-describedby="tbl-sql-clauses-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;">Clause</th>
<th style="text-align: left;">Purpose</th>
<th style="text-align: left;">dplyr equivalent</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>SELECT</code></td>
<td style="text-align: left;">Choose columns, compute values</td>
<td style="text-align: left;">
<code>select()</code>, <code>mutate()</code>
</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>FROM</code></td>
<td style="text-align: left;">Specify the table</td>
<td style="text-align: left;">The data frame name</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>WHERE</code></td>
<td style="text-align: left;">Filter rows</td>
<td style="text-align: left;"><code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>GROUP BY</code></td>
<td style="text-align: left;">Define groups for aggregation</td>
<td style="text-align: left;"><code>group_by()</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>ORDER BY</code></td>
<td style="text-align: left;">Sort results</td>
<td style="text-align: left;"><code>arrange()</code></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section></section><section id="sec-dbplyr" class="level2" data-number="12.6"><h2 data-number="12.6" class="anchored" data-anchor-id="sec-dbplyr">
<span class="header-section-number">12.6</span> Using dbplyr: dplyr for Databases</h2>
<p><strong>dbplyr</strong> is a dplyr backend that translates your dplyr code to SQL and runs it on the database. This means you can use familiar tidyverse syntax without learning SQL.</p>
<section id="creating-a-database-reference" class="level3"><h3 class="anchored" data-anchor-id="creating-a-database-reference">Creating a Database Reference</h3>
<p>Use <code>tbl()</code> to create a reference to a database table:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>mtcars_db <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"mtcars"</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>mtcars_db</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-reference" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-reference-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.3
</figcaption><div aria-describedby="tbl-reference-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">mpg</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">disp</th>
<th style="text-align: right;">hp</th>
<th style="text-align: right;">drat</th>
<th style="text-align: right;">wt</th>
<th style="text-align: right;">qsec</th>
<th style="text-align: right;">vs</th>
<th style="text-align: right;">am</th>
<th style="text-align: right;">gear</th>
<th style="text-align: right;">carb</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.620</td>
<td style="text-align: right;">16.46</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.875</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">108.0</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">3.85</td>
<td style="text-align: right;">2.320</td>
<td style="text-align: right;">18.61</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">258.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.215</td>
<td style="text-align: right;">19.44</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">360.0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">18.1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">225.0</td>
<td style="text-align: right;">105</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">3.460</td>
<td style="text-align: right;">20.22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">14.3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">360.0</td>
<td style="text-align: right;">245</td>
<td style="text-align: right;">3.21</td>
<td style="text-align: right;">3.570</td>
<td style="text-align: right;">15.84</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">24.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">146.7</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">3.69</td>
<td style="text-align: right;">3.190</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">140.8</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">3.92</td>
<td style="text-align: right;">3.150</td>
<td style="text-align: right;">22.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">19.2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">167.6</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">3.92</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">18.30</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">167.6</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">3.92</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">18.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">16.4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">275.8</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">4.070</td>
<td style="text-align: right;">17.40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17.3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">275.8</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">3.730</td>
<td style="text-align: right;">17.60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">15.2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">275.8</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">3.780</td>
<td style="text-align: right;">18.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">472.0</td>
<td style="text-align: right;">205</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">5.250</td>
<td style="text-align: right;">17.98</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">460.0</td>
<td style="text-align: right;">215</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">5.424</td>
<td style="text-align: right;">17.82</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">14.7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">440.0</td>
<td style="text-align: right;">230</td>
<td style="text-align: right;">3.23</td>
<td style="text-align: right;">5.345</td>
<td style="text-align: right;">17.42</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">32.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">78.7</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">4.08</td>
<td style="text-align: right;">2.200</td>
<td style="text-align: right;">19.47</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">75.7</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">4.93</td>
<td style="text-align: right;">1.615</td>
<td style="text-align: right;">18.52</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">33.9</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">71.1</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">4.22</td>
<td style="text-align: right;">1.835</td>
<td style="text-align: right;">19.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21.5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">120.1</td>
<td style="text-align: right;">97</td>
<td style="text-align: right;">3.70</td>
<td style="text-align: right;">2.465</td>
<td style="text-align: right;">20.01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">318.0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">3.520</td>
<td style="text-align: right;">16.87</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15.2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">304.0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">3.435</td>
<td style="text-align: right;">17.30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">13.3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">350.0</td>
<td style="text-align: right;">245</td>
<td style="text-align: right;">3.73</td>
<td style="text-align: right;">3.840</td>
<td style="text-align: right;">15.41</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19.2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">400.0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.845</td>
<td style="text-align: right;">17.05</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">79.0</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">4.08</td>
<td style="text-align: right;">1.935</td>
<td style="text-align: right;">18.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">26.0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">120.3</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">4.43</td>
<td style="text-align: right;">2.140</td>
<td style="text-align: right;">16.70</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">95.1</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">3.77</td>
<td style="text-align: right;">1.513</td>
<td style="text-align: right;">16.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15.8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">351.0</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">4.22</td>
<td style="text-align: right;">3.170</td>
<td style="text-align: right;">14.50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">19.7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">145.0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.62</td>
<td style="text-align: right;">2.770</td>
<td style="text-align: right;">15.50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15.0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">301.0</td>
<td style="text-align: right;">335</td>
<td style="text-align: right;">3.54</td>
<td style="text-align: right;">3.570</td>
<td style="text-align: right;">14.60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">121.0</td>
<td style="text-align: right;">109</td>
<td style="text-align: right;">4.11</td>
<td style="text-align: right;">2.780</td>
<td style="text-align: right;">18.60</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Notice that this doesn’t load the data—it just creates a reference. The data stays in the database.</p>
</section><section id="lazy-evaluation" class="level3"><h3 class="anchored" data-anchor-id="lazy-evaluation">Lazy Evaluation</h3>
<p>dbplyr operations are <strong>lazy</strong>: they build up a query without executing it until you explicitly request the data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Build a query (doesn't execute yet)</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>efficient_cars <span class="ot">&lt;-</span> mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">filter</span>(mpg <span class="sc">&gt;</span> <span class="dv">25</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">select</span>(mpg, cyl, hp, wt) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mpg))</span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co"># See the generated SQL</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>efficient_cars <span class="sc">|&gt;</span> <span class="fu">show_query</span>()</span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt; &lt;SQL&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt; SELECT mpg, cyl, hp, wt</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt; FROM mtcars</span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt; WHERE (mpg &gt; 25.0)</span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt; ORDER BY mpg DESC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="collecting-results" class="level3"><h3 class="anchored" data-anchor-id="collecting-results">Collecting Results</h3>
<p>Use <code>collect()</code> to execute the query and bring results into R:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Execute query and return results to R</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>efficient_cars <span class="sc">|&gt;</span> <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">mpg</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">hp</th>
<th style="text-align: right;">wt</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">33.9</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">1.835</td>
</tr>
<tr class="even">
<td style="text-align: right;">32.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">2.200</td>
</tr>
<tr class="odd">
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">1.615</td>
</tr>
<tr class="even">
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">1.513</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">1.935</td>
</tr>
<tr class="even">
<td style="text-align: right;">26.0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">2.140</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Only <code>collect()</code> what you need! Fetching an entire large table defeats the purpose of using a database. Filter and aggregate in the database first, then collect the summarized results.</p>
</div>
</div>
</section></section><section id="sec-dplyr-sql" class="level2" data-number="12.7"><h2 data-number="12.7" class="anchored" data-anchor-id="sec-dplyr-sql">
<span class="header-section-number">12.7</span> Translating dplyr to SQL</h2>
<p>dbplyr translates dplyr verbs to SQL clauses. Let’s see how common operations map:</p>
<section id="filtering-and-selecting" class="level3"><h3 class="anchored" data-anchor-id="filtering-and-selecting">Filtering and Selecting</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">filter</span>(cyl <span class="sc">==</span> <span class="dv">6</span>, mpg <span class="sc">&gt;</span> <span class="dv">18</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">select</span>(mpg, cyl, hp, wt) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="fu">show_query</span>()</span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#&gt; &lt;SQL&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#&gt; SELECT mpg, cyl, hp, wt</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt; FROM mtcars</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">#&gt; WHERE (cyl = 6.0) AND (mpg &gt; 18.0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="mutating-creating-new-columns" class="level3"><h3 class="anchored" data-anchor-id="mutating-creating-new-columns">Mutating (Creating New Columns)</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="at">efficiency =</span> mpg <span class="sc">/</span> wt,</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="at">hp_per_cyl =</span> hp <span class="sc">/</span> cyl</span>
<span id="cb12-5"><a href="#cb12-5"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="fu">select</span>(mpg, wt, efficiency, hp_per_cyl) <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="fu">show_query</span>()</span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">#&gt; &lt;SQL&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co">#&gt; SELECT mpg, wt, mpg / wt AS efficiency, hp / cyl AS hp_per_cyl</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">#&gt; FROM mtcars</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="grouping-and-summarizing" class="level3"><h3 class="anchored" data-anchor-id="grouping-and-summarizing">Grouping and Summarizing</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">summarize</span>(</span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="at">avg_mpg =</span> <span class="fu">mean</span>(mpg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="at">max_hp =</span> <span class="fu">max</span>(hp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-7"><a href="#cb13-7"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="fu">show_query</span>()</span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">#&gt; &lt;SQL&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">#&gt; SELECT cyl, COUNT(*) AS n, AVG(mpg) AS avg_mpg, MAX(hp) AS max_hp</span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">#&gt; FROM mtcars</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">#&gt; GROUP BY cyl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="arranging-sorting" class="level3"><h3 class="anchored" data-anchor-id="arranging-sorting">Arranging (Sorting)</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">arrange</span>(cyl, <span class="fu">desc</span>(mpg)) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">show_query</span>()</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">#&gt; &lt;SQL&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co">#&gt; SELECT mtcars.*</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">#&gt; FROM mtcars</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">#&gt; ORDER BY cyl, mpg DESC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="sec-sql-syntax" class="level2" data-number="12.8"><h2 data-number="12.8" class="anchored" data-anchor-id="sec-sql-syntax">
<span class="header-section-number">12.8</span> SQL Syntax Details</h2>
<p>Understanding SQL helps you write better dbplyr code and debug issues.</p>
<section id="key-differences-from-r" class="level3"><h3 class="anchored" data-anchor-id="key-differences-from-r">Key Differences from R</h3>
<div id="tbl-r-sql-syntax" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-r-sql-syntax-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.4: Syntax differences between R and SQL
</figcaption><div aria-describedby="tbl-r-sql-syntax-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">R/dplyr</th>
<th style="text-align: left;">SQL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Equality</td>
<td style="text-align: left;"><code>==</code></td>
<td style="text-align: left;"><code>=</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Logical AND</td>
<td style="text-align: left;"><code>&amp;</code></td>
<td style="text-align: left;"><code>AND</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Logical OR</td>
<td style="text-align: left;"><code>|</code></td>
<td style="text-align: left;"><code>OR</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Missing values</td>
<td style="text-align: left;"><code>NA</code></td>
<td style="text-align: left;"><code>NULL</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Strings</td>
<td style="text-align: left;">
<code>"text"</code> or <code>'text'</code>
</td>
<td style="text-align: left;">
<code>'text'</code> only</td>
</tr>
<tr class="even">
<td style="text-align: left;">Case sensitivity</td>
<td style="text-align: left;">Case sensitive</td>
<td style="text-align: left;">Keywords case insensitive</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section><section id="null-handling" class="level3"><h3 class="anchored" data-anchor-id="null-handling">NULL Handling</h3>
<p>SQL’s <code>NULL</code> behaves like R’s <code>NA</code>—it’s “contagious” in calculations:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mpg)) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">show_query</span>()</span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">#&gt; &lt;SQL&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#&gt; SELECT mtcars.*</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">#&gt; FROM mtcars</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">#&gt; WHERE (NOT((mpg IS NULL)))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="subqueries" class="level3"><h3 class="anchored" data-anchor-id="subqueries">Subqueries</h3>
<p>Sometimes dbplyr generates subqueries—queries nested inside other queries:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">mutate</span>(<span class="at">mpg_group =</span> <span class="fu">if_else</span>(mpg <span class="sc">&gt;</span> <span class="dv">20</span>, <span class="st">"high"</span>, <span class="st">"low"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">filter</span>(mpg_group <span class="sc">==</span> <span class="st">"high"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">show_query</span>()</span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">#&gt; &lt;SQL&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">#&gt; SELECT q01.*</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co">#&gt; FROM (</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="co">#&gt;   SELECT</span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="co">#&gt;     mtcars.*,</span></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="co">#&gt;     CASE WHEN (mpg &gt; 20.0) THEN 'high' WHEN NOT (mpg &gt; 20.0) THEN 'low' </span><span class="re">END</span><span class="co"> AS mpg_group</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co">#&gt;   FROM mtcars</span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co">#&gt; ) q01</span></span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="co">#&gt; WHERE (mpg_group = 'high')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The subquery is needed because SQL evaluates <code>WHERE</code> before <code>SELECT</code>, so you can’t filter on a column you’re creating in the same query.</p>
</section></section><section id="sec-db-multiple-tables" class="level2" data-number="12.9"><h2 data-number="12.9" class="anchored" data-anchor-id="sec-db-multiple-tables">
<span class="header-section-number">12.9</span> Working with Multiple Tables</h2>
<p>Databases often store data across multiple related tables (normalized data). You can use joins in dbplyr just like with regular data frames:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Join tables in the database</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>orders_db <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">left_join</span>(customers_db, <span class="at">by =</span> <span class="st">"customer_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The join is executed in the database, which is much more efficient than loading both tables into R and joining there.</p>
</section><section id="sec-window-functions" class="level2" data-number="12.10"><h2 data-number="12.10" class="anchored" data-anchor-id="sec-window-functions">
<span class="header-section-number">12.10</span> Window Functions</h2>
<p>SQL window functions perform calculations across sets of rows related to the current row. dbplyr translates functions like <code><a href="https://rdrr.io/r/stats/lag.html">lag()</a></code>, <code>lead()</code>, and <code><a href="https://rdrr.io/r/base/rank.html">rank()</a></code> to their SQL equivalents:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-4"><a href="#cb18-4"></a>    <span class="at">rank_mpg =</span> <span class="fu">min_rank</span>(<span class="fu">desc</span>(mpg)),</span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="at">mpg_vs_avg =</span> mpg <span class="sc">-</span> <span class="fu">mean</span>(mpg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-6"><a href="#cb18-6"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="fu">select</span>(cyl, mpg, rank_mpg, mpg_vs_avg) <span class="sc">|&gt;</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="fu">show_query</span>()</span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="co">#&gt; &lt;SQL&gt;</span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="co">#&gt; SELECT</span></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="co">#&gt;   cyl,</span></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="co">#&gt;   mpg,</span></span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="co">#&gt;   CASE</span></span>
<span id="cb18-14"><a href="#cb18-14"></a><span class="co">#&gt; WHEN (NOT((mpg IS NULL))) THEN RANK() OVER (PARTITION BY cyl, (CASE WHEN ((mpg IS NULL)) THEN 1 ELSE 0 </span><span class="re">END</span><span class="co">) ORDER BY mpg DESC)</span></span>
<span id="cb18-15"><a href="#cb18-15"></a><span class="co">#&gt; </span><span class="re">END</span><span class="co"> AS rank_mpg,</span></span>
<span id="cb18-16"><a href="#cb18-16"></a><span class="co">#&gt;   mpg - AVG(mpg) OVER (PARTITION BY cyl) AS mpg_vs_avg</span></span>
<span id="cb18-17"><a href="#cb18-17"></a><span class="co">#&gt; FROM mtcars</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-db-best-practices" class="level2" data-number="12.11"><h2 data-number="12.11" class="anchored" data-anchor-id="sec-db-best-practices">
<span class="header-section-number">12.11</span> Best Practices</h2>
<section id="filter-early" class="level3"><h3 class="anchored" data-anchor-id="filter-early">1. Filter Early</h3>
<p>Push filtering to the database rather than collecting all data and filtering in R:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Good: Filter in database</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="fu">filter</span>(mpg <span class="sc">&gt;</span> <span class="dv">25</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="fu">collect</span>()</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co"># Bad: Collect everything then filter</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="fu">filter</span>(mpg <span class="sc">&gt;</span> <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="select-only-needed-columns" class="level3"><h3 class="anchored" data-anchor-id="select-only-needed-columns">2. Select Only Needed Columns</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Good: Select specific columns</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">select</span>(mpg, cyl, hp) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="fu">collect</span>()</span>
<span id="cb20-5"><a href="#cb20-5"></a></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="co"># Bad: Collect all columns</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>  <span class="fu">select</span>(mpg, cyl, hp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="aggregate-in-the-database" class="level3"><h3 class="anchored" data-anchor-id="aggregate-in-the-database">3. Aggregate in the Database</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Good: Summarize in database</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="fu">summarize</span>(<span class="at">avg_mpg =</span> <span class="fu">mean</span>(mpg)) <span class="sc">|&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="fu">collect</span>()</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co"># Bad: Collect then summarize</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>mtcars_db <span class="sc">|&gt;</span></span>
<span id="cb21-9"><a href="#cb21-9"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">|&gt;</span></span>
<span id="cb21-11"><a href="#cb21-11"></a>  <span class="fu">summarize</span>(<span class="at">avg_mpg =</span> <span class="fu">mean</span>(mpg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="close-connections" class="level3"><h3 class="anchored" data-anchor-id="close-connections">4. Close Connections</h3>
<p>Always close your database connection when you’re done:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">dbDisconnect</span>(con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="sec-when-databases" class="level2" data-number="12.12"><h2 data-number="12.12" class="anchored" data-anchor-id="sec-when-databases">
<span class="header-section-number">12.12</span> When to Use Databases</h2>
<p>Databases are valuable when:</p>
<ul>
<li>
<strong>Data is too large for memory</strong>: Even modest databases handle billions of rows</li>
<li>
<strong>Multiple users need access</strong>: Databases manage concurrent access safely</li>
<li>
<strong>Data changes frequently</strong>: Updates are immediate, no file copying needed</li>
<li>
<strong>You need specific subsets</strong>: Queries return just what you need</li>
<li>
<strong>Data integrity matters</strong>: Constraints prevent invalid data</li>
</ul>
<p>For smaller datasets that fit comfortably in memory, regular data frames are simpler and faster for exploratory analysis.</p>
</section><section id="sec-db-summary" class="level2" data-number="12.13"><h2 data-number="12.13" class="anchored" data-anchor-id="sec-db-summary">
<span class="header-section-number">12.13</span> Summary</h2>
<p>In this chapter, you learned how to:</p>
<ul>
<li>Connect to databases from R using DBI</li>
<li>Use duckdb as a lightweight analytical database</li>
<li>Write basic SQL queries with SELECT, WHERE, and GROUP BY</li>
<li>Use dbplyr to work with databases using familiar dplyr syntax</li>
<li>Translate dplyr operations to SQL and understand the generated queries</li>
<li>Apply best practices for efficient database access</li>
</ul>
<p>The combination of dbplyr and DBI lets you leverage your existing tidyverse skills while accessing data at any scale. When you need to work with data too large for memory or collaborate with others through a shared database, these tools let you stay productive without learning an entirely new programming paradigm.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For reference on dplyr and tidyverse functions used with databases, see <a href="appendix-r.html" class="quarto-xref"><span>Appendix C</span></a>.</p>
</div>
</div>
</section><section id="exercises" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="exercises">Exercises</h2>
<ol type="1">
<li><p><strong>Basic Connection</strong>: Connect to a duckdb database and load the <code><a href="https://rdrr.io/pkg/nycflights13/man/flights.html">nycflights13::flights</a></code> data into a table called “flights”.</p></li>
<li>
<p><strong>SQL Practice</strong>: Write SQL queries to:</p>
<ul>
<li>Find all flights from JFK airport</li>
<li>Calculate the average departure delay by carrier</li>
<li>Find the 10 destinations with the most flights</li>
</ul>
</li>
<li><p><strong>dbplyr Translation</strong>: Use dbplyr to write the equivalent dplyr code for each SQL query above. Compare the generated SQL with your hand-written queries.</p></li>
<li>
<p><strong>Efficient Querying</strong>: Given a database with a large “sales” table:</p>
<ul>
<li>What’s wrong with: <code>tbl(con, "sales") |&gt; collect() |&gt; filter(year == 2023)</code>?</li>
<li>How would you rewrite this query efficiently?</li>
</ul>
</li>
<li>
<p><strong>Joins in Databases</strong>: If you have two tables, “experiments” and “samples”, linked by sample_id:</p>
<ul>
<li>Write dbplyr code to join them</li>
<li>Use <code>show_query()</code> to see the generated SQL</li>
<li>Explain when the join happens (in R or in the database)</li>
</ul>
</li>
</ol></section><section id="additional-resources" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="https://dbi.r-dbi.org/">DBI package documentation</a></li>
<li><a href="https://dbplyr.tidyverse.org/">dbplyr package documentation</a></li>
<li><a href="https://duckdb.org/docs/api/r">duckdb for R</a></li>
<li>
<a href="https://sqlfordatascientists.com">SQL for Data Scientists</a> by Renée M. P. Teate</li>
<li>
<a href="https://www.practicalsql.com">Practical SQL</a> by Anthony DeBarros</li>
</ul>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/14-parallel-computing.html" class="pagination-link" aria-label="Parallel Computing in R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Parallel Computing in R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/12-quarto-documents.html" class="pagination-link" aria-label="Reproducible Documents with Quarto">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Reproducible Documents with Quarto</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 William A. Cresko | Knight Campus for Accelerating Scientific Impact</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/wcresko/BioE_Comp_Tools_Book/edit/main/chapters/15-databases.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/wcresko/BioE_Comp_Tools_Book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>


</body></html>